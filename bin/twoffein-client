#!/usr/bin/env ruby

require 'optparse'
#require 'methadone'
require 'thor'
require 'twoffein-client'

module Twoffein
  class CLI < Thor
    #include Methadone::Main
    #include Methadone::CLILogging
    include Twoffein

    #class_option :default => :help

    map "-p" => :profile
    desc "profile [PROFILE]", "List the profile, which you have chosen by PROFILE"
    #method_option :grep, :type => :string, :aliases => "-g" # TODO
    def profile(profile=nil)
      #if options[:grep]
        #puts Profiles.search(/#{options["grep"]}/i)
      #else
        puts Profile.get profile
      #end
    end

    map "-d" => :drinks
    desc "drinks", "List all drinks"
    method_option :grep, :type => :string, :aliases => "-g"
    def drinks(profile=nil)
      if options[:grep]
        puts Drinks.search(/#{options["grep"]}/i)
      else
        #puts Util.format('Drink') + 'Key'
        puts "Drink  (Key)"
        puts Drinks.new
      end
    end

    map "-t" => :tweet
    desc "tweet DRINK", "Tweet your drinking drink"
    method_option :with, :type => :string, :aliases => "-w"
    def tweet(drink)
      tweet = Tweet.new(drink, options[:with])
      puts tweet.to_s
      begin
        info = tweet.publish
        puts 'Info: ' + info[:info]
        puts 'Drinks today: ' + info[:tweets].to_s unless info[:tweets].nil?
      rescue Twoffein::Error => e
        puts e.message
      end
    end

    map "-c" => :cookie
    desc "cookie RECEIVER", "Give cookie to RECEIVER"
    def cookie(receiver)
      cookie = Cookie.new(receiver)
      begin
        info = cookie.send
        puts 'Info: ' + info[:info]
      rescue Twoffein::Error => e
        puts e.message
      end
    end

    map "-v" => :version, "--version" => :version
    desc "version", "Print version"
    def version
      puts "version #{Client::VERSION}"
    end

    #def help
      #desc = <<-EODESC
#Client for API twoffein.de
#API in version 0.1
      #EODESC
      ##description desc.chomp
      #puts "HELP"
    #end
  end
end

Twoffein::CLI.start
